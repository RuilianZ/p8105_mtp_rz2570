p8105\_mtp\_rz2570
================
Ruilian Zhang
10/21/2021

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──

    ## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
    ## ✓ tibble  3.1.4     ✓ dplyr   1.0.7
    ## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
    ## ✓ readr   2.0.1     ✓ forcats 0.5.1

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(readxl)
```

## Problem 1 - Data

``` r
horn_df = read_excel("data/p8105_mtp_data.xlsx", range = "A9:I1230") %>% 
  janitor::clean_names() %>% 
  mutate_at("eop_size_mm", ~replace(., is.na(.), 0))

horn_df = horn_df %>% 
  mutate(sex = factor(sex),
         age_group = factor(age_group),
         eop_size = factor(eop_size),
         eop_visibility_classification = factor(eop_visibility_classification),
         eop_shape = factor(eop_shape),
         fhp_category = factor(fhp_category)
         )

horn_df %>% 
  group_by(sex) %>% 
  summarize(n = n()) %>% 
  knitr::kable()
```

| sex |   n |
|:----|----:|
| 0   | 614 |
| 1   | 607 |

``` r
horn_df %>% 
  group_by(age_group) %>% 
  summarize(n = n()) %>% 
  knitr::kable()
```

| age\_group |   n |
|:-----------|----:|
| 1          |   2 |
| 2          | 303 |
| 3          | 204 |
| 4          | 207 |
| 5          | 200 |
| 6          | 178 |
| 7          | 126 |
| 8          |   1 |

``` r
horn_df %>% 
  group_by(sex, age_group) %>% 
  summarize(n = n()) %>%
  pivot_wider(names_from = age_group,
              values_from = n) %>% 
  mutate(sex = recode(sex, '0' = "Female", '1' = "Male")) %>% 
  knitr::kable()
```

    ## `summarise()` has grouped output by 'sex'. You can override using the `.groups` argument.

| sex    |   1 |   2 |   3 |   4 |   5 |   6 |   7 |   8 |
|:-------|----:|----:|----:|----:|----:|----:|----:|----:|
| Female |   1 | 151 | 102 | 106 |  99 |  89 |  65 |   1 |
| Male   |   1 | 152 | 102 | 101 | 101 |  89 |  61 |  NA |

-   Data cleaning: read the excel and change variable names to snake
    case, then fill the missing data in `eop_size_mm` with `0` create
    and ordered factors for catagorical variables.  
-   Describe dataset: there are values of 9 related variables collecting
    from 1221 participants. The participants are defined by their sex,
    age, as well as the size, visibility and shape of their external
    occipital protuberance (EOP). There are also variables containing
    information of the degree of forward head protraction (FHP). There
    are numeric as well as categorical variables respectively depicting
    the value and level of corresponding variable.  
-   The age and gender distribution: the gender of participants
    generally distributes equally among men and women, with 614 women
    and 607 men. The participants come from 8 age group, among which the
    2nd group (18-30 age) has the most (303) participants, and 8th group
    (60+ age) has the least (1) participant. The distribution of age
    looks right-skewed since the mode locates on group 2 and there are
    less participants in age group 6+. From the combined table of gender
    and age group, we can see the distribution of age is generally the
    same across gender. Also, there is no male participants in age
    group 8.

``` r
horn_df %>% 
  ggplot(aes(x = eop_size)) +
  geom_bar()
```

![](p8105_mtp_rz2570_files/figure-gfm/plot%20categorical%20variables-1.png)<!-- -->

``` r
horn_df %>% 
  ggplot(aes(x = eop_visibility_classification)) +
  geom_bar()
```

![](p8105_mtp_rz2570_files/figure-gfm/plot%20categorical%20variables-2.png)<!-- -->

``` r
horn_df %>% 
  ggplot(aes(x = eop_shape)) +
  geom_bar()
```

![](p8105_mtp_rz2570_files/figure-gfm/plot%20categorical%20variables-3.png)<!-- -->

``` r
horn_df %>% 
  ggplot(aes(x = fhp_category)) +
  geom_bar()
```

![](p8105_mtp_rz2570_files/figure-gfm/plot%20categorical%20variables-4.png)<!-- -->

-   Issues in data: from the barplots of each **categorical variable**
    we can see the distribution of these variables.
    -   For `eop_size`, there is one value — `14.6` — that does not
        correctly implement the definition based on underlying
        continuous variable `eop_size_mm`, which is a decimal instead of
        an integer.  
    -   For `eop_visibility_classification`, it correctly implement the
        definition based on underlying continuous variable
        `eop_size_mm`.  
    -   For `eop_shape`, there are some missing values need to be
        addressed.  
    -   For `fhp_category`, there is one value — `30.8` — that does not
        correctly implement the definition based on underlying
        continuous variable `fhp_size_mm`.
-   The rows of two erroneous value are respectively extracted as below:

``` r
filter(horn_df, eop_size == "14.6")
```

    ## # A tibble: 1 × 9
    ##   sex     age age_group eop_size_mm eop_size eop_visibility_classific… eop_shape
    ##   <fct> <dbl> <fct>           <dbl> <fct>    <fct>                     <fct>    
    ## 1 1        62 6                  15 14.6     2                         2        
    ## # … with 2 more variables: fhp_size_mm <dbl>, fhp_category <fct>

``` r
filter(horn_df, fhp_category == "30.8")
```

    ## # A tibble: 1 × 9
    ##   sex     age age_group eop_size_mm eop_size eop_visibility_classific… eop_shape
    ##   <fct> <dbl> <fct>           <dbl> <fct>    <fct>                     <fct>    
    ## 1 0        51 5                   0 0        0                         <NA>     
    ## # … with 2 more variables: fhp_size_mm <dbl>, fhp_category <fct>

## Problem 2 - Visualization

``` r
horn_df %>% 
  ggplot(aes(x = age, y = fhp_size_mm, group = sex, fill = sex)) +
  geom_bar(stat = "identity") +
  labs(x = "Age",
       y = "Forward Head Protraction Size (mm)") +
  scale_x_continuous(breaks = c(seq(from = 0, to = 80, by = 20))) + 
  scale_fill_discrete(name = "Sex", labels = c("Female", "Male"))
```

    ## Warning: Removed 6 rows containing missing values (position_stack).

![](p8105_mtp_rz2570_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

``` r
horn_df %>% 
  mutate(eop_enlarged = ifelse(eop_size %in% c(0, 1), "non_enlarged", "enlarged")) %>% 
  group_by(age_group, eop_enlarged) %>% 
  summarize(n_obs = n()) %>% 
  pivot_wider(
    names_from = eop_enlarged,
    values_from = n_obs) %>% 
  mutate_at("enlarged", ~replace(., is.na(.), 0))
```

    ## `summarise()` has grouped output by 'age_group'. You can override using the `.groups` argument.

    ## # A tibble: 8 × 3
    ## # Groups:   age_group [8]
    ##   age_group non_enlarged enlarged
    ##   <fct>            <int>    <dbl>
    ## 1 1                    2        0
    ## 2 2                  153      150
    ## 3 3                  151       53
    ## 4 4                  163       44
    ## 5 5                  149       51
    ## 6 6                  114       64
    ## 7 7                   94       32
    ## 8 8                    1        0
